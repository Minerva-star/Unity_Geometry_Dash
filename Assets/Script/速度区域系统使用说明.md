# 速度区域系统使用说明

## 系统概述

这个速度区域系统允许玩家在碰到特定的BoxCollider2D时获得加速或减速效果。系统支持多种速度修改器叠加、临时效果、永久效果等功能。

## 核心组件

### 1. PlayerBehavior.cs (已修改)
- 添加了速度管理功能
- 支持多个速度修改器叠加
- 提供速度改变事件

### 2. SpeedZone.cs (新增)
- 定义速度区域的行为
- 处理玩家进入/离开事件
- 提供视觉和音效反馈

### 3. SpeedZoneExample.cs (新增)
- 演示如何使用系统
- 提供测试功能

## 使用方法

### 方法一：通过SpeedZone组件创建速度区域

1. **创建速度区域对象**
   ```
   1. 在场景中创建一个空的GameObject
   2. 添加BoxCollider2D组件
   3. 添加SpeedZone脚本
   4. 设置标签为"SpeedZone"
   ```

2. **配置SpeedZone参数**
   ```
   - Zone Name: 区域名称
   - Speed Multiplier: 速度倍率 (1.0=正常, 2.0=双倍, 0.5=一半)
   - Duration: 持续时间 (-1=永久, 正数=秒数)
   - Remove On Exit: 离开时是否移除效果
   - Zone Color: 区域颜色
   - Enter/Exit Sound: 进入/离开音效
   ```

### 方法二：通过代码创建速度区域

```csharp
// 创建加速区域 (2倍速度，持续5秒)
CreateSpeedZone(2f, "加速区域", 5f);

// 创建减速区域 (0.5倍速度，永久)
CreateSpeedZone(0.5f, "减速区域", -1f);

// 创建临时加速 (1.5倍速度，持续3秒)
CreateSpeedZone(1.5f, "临时加速", 3f);
```

### 方法三：直接操作速度修改器

```csharp
// 获取PlayerBehavior引用
PlayerBehavior player = FindObjectOfType<PlayerBehavior>();

// 添加速度修改器
player.AddSpeedModifier("加速", 2f, 5f);

// 移除特定修改器
player.RemoveSpeedModifier("加速");

// 清除所有修改器
player.ClearAllSpeedModifiers();

// 获取速度信息
string info = player.GetSpeedInfo();
```

## 功能特性

### 1. 多修改器叠加
- 支持同时激活多个速度修改器
- 倍率相乘计算最终速度
- 例如：1.5x × 2.0x = 3.0x

### 2. 时间控制
- 支持永久效果 (duration = -1)
- 支持临时效果 (duration > 0)
- 自动移除过期修改器

### 3. 事件系统
```csharp
// 订阅速度改变事件
player.OnSpeedChanged += (newSpeed) => {
    Debug.Log($"速度改变为: {newSpeed}");
    // 更新UI、播放音效等
};
```

### 4. 视觉反馈
- 区域在Scene视图中显示颜色
- 激活时颜色变化
- Gizmos显示区域范围

### 5. 音效支持
- 进入区域音效
- 离开区域音效
- 自动播放

## 测试方法

### 1. 使用SpeedZoneExample
1. 将SpeedZoneExample脚本添加到场景中的对象上
2. 设置speedZonePrefab
3. 运行游戏，使用GUI按钮测试

### 2. 键盘快捷键
- 按1键：创建2x加速区域(5秒)
- 按2键：创建0.5x减速区域(3秒)
- 按3键：清除所有修改器

### 3. 调试信息
- 控制台会输出详细的速度变化信息
- 使用PrintSpeedInfo()查看当前状态

## 配置示例

### 加速区域配置
```
Zone Name: "加速区域"
Speed Multiplier: 2.0
Duration: 5.0
Remove On Exit: true
Zone Color: Green
```

### 减速区域配置
```
Zone Name: "减速区域"
Speed Multiplier: 0.5
Duration: -1
Remove On Exit: true
Zone Color: Red
```

### 临时加速配置
```
Zone Name: "临时加速"
Speed Multiplier: 1.5
Duration: 3.0
Remove On Exit: false
Zone Color: Yellow
```

## 注意事项

1. **标签设置**：确保速度区域对象设置了"SpeedZone"标签
2. **触发器设置**：BoxCollider2D必须设置为isTrigger = true
3. **玩家碰撞器**：确保玩家有Collider2D组件
4. **性能考虑**：大量速度区域可能影响性能，建议适当优化

## 扩展功能

### 1. 添加新的速度效果类型
```csharp
public enum SpeedEffectType
{
    Acceleration,    // 加速
    Deceleration,    // 减速
    Boost,          // 爆发
    SlowMotion      // 慢动作
}
```

### 2. 添加速度曲线
```csharp
public AnimationCurve speedCurve; // 速度变化曲线
```

### 3. 添加粒子效果
```csharp
public ParticleSystem speedParticles; // 速度效果粒子
```

## 故障排除

### 问题1：速度区域不生效
- 检查标签是否正确设置为"SpeedZone"
- 检查BoxCollider2D是否设置为触发器
- 检查玩家是否有Collider2D组件

### 问题2：速度计算错误
- 检查baseRightVelocity是否正确设置
- 检查speedMultiplier值是否合理
- 查看控制台调试信息

### 问题3：音效不播放
- 检查AudioSource组件是否存在
- 检查音效文件是否正确分配
- 检查音量设置

## 版本历史

- v1.0: 基础速度区域系统
- 支持多修改器叠加
- 支持时间控制
- 支持事件系统
- 支持视觉和音效反馈 